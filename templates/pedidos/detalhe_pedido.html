{% extends "base.html" %}
{% load static %}
{% block title %}Pedido {{ pedido.numero }}{% endblock %}

{% block content %}
<h1>Pedido {{ pedido.numero }} — {{ pedido.nome_cliente }}</h1>

{% if pedido.status == "RASC" %}


<button type="button" class="btn ghost"
        onclick="if (document.referrer) { history.back(); } else { window.location.href='{% url 'pedidos:criar' %}'; }">
  ← Voltar
</button>
{% endif %}

<div class="card" style="margin-bottom:16px;">
  <div class="row" style="justify-content: space-between;">
    <div>
      <strong>Status:</strong>
      <span class="badge">{{ pedido.get_status_display }}</span>
    </div>
    <div>
      <strong>Total:</strong>
      R$ {{ total|floatformat:2 }}
    </div>
  </div>
</div>

<div class="card">
  <table style="width:100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th style="text-align:left; padding:8px;">Item</th>
        <th style="text-align:right; padding:8px;">Qtd</th>
        <th style="text-align:right; padding:8px;">Preço unit.</th>
        <th style="text-align:right; padding:8px;">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      {% for it in itens %}
      <tr style="border-top:1px solid var(--border);">
        <td style="padding:8px;">{{ it.nome }}</td>
        <td style="padding:8px; text-align:right;">{{ it.qtd }}</td>
        <td style="padding:8px; text-align:right;">R$ {{ it.unit|floatformat:2 }}</td>
        <td style="padding:8px; text-align:right;"><strong>R$ {{ it.subtotal|floatformat:2 }}</strong></td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" style="padding:12px; text-align:center; color:var(--muted);">
          Nenhum item neste pedido.
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr style="border-top:2px solid var(--border);">
        <td colspan="3" style="padding:10px; text-align:right;"><strong>Total</strong></td>
        <td style="padding:10px; text-align:right;"><strong>R$ {{ total|floatformat:2 }}</strong></td>
      </tr>
    </tfoot>
  </table>
</div>



{% if pedido.status == "RASC" %}
  <div class="row end" style="margin-top:12px;">
    <a class="btn primary" href="{% url 'pedidos:confirmar' pedido.pk %}">
      Confirmar e Enviar à Cozinha
    </a>

    <form method="post" action="{% url 'pedidos:cancelar' pedido.pk %}"
          onsubmit="return confirm('Tem certeza que deseja cancelar este pedido?');">
      {% csrf_token %}
      <button type="submit" class="btn danger">Cancelar pedido</button>
    </form>
  </div>
{% endif %}

{% if pedido.status == "ENVC" %}
  <p>
    <strong>Status:</strong> {{ pedido.get_status_display }}
    {% if pedido.finalizado_em %}
      • <strong>Finalizado às:</strong> {{ pedido.finalizado_em|date:"H:i d/m/Y" }}
    {% endif %}
  </p>

  <div class="row end" style="margin-top:12px;">
    <form method="post" action="{% url 'pedidos:concluir' pedido.pk %}">
      {% csrf_token %}
      <button type="submit" class="btn primary">Concluir pedido</button>
    </form>
  </div>
{% endif %}
{% endblock %}
